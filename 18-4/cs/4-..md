# 4장. 프로그램의 구조와 실행

## 1. 프로그램의 구조와 인터럽트

컴퓨터 프로그램의 내부 구조는 함수로 구성됨. 이 프로그램들이 CPU에서 명령을 수행하려면 해당 명령을 담은 프로그램의 주소 영역이 메모리에 올라가 있어야 함.

**프로그램의 주소 영역**

1. 코드 : 우리가 작성한 프로그램 함수들의 코드가 CPU에서 수행할 수 있는 기계어 명령 형태로 변환되어 저장되는 부분
2. 데이터 : 전역 변수 등 프로그램이 사용하는 데이터를 저장하는 부분
3. 스택 : 함수가 호출될 때 호출된 함수의 수행을 마치고 복귀할 주소 및 데이터를 임시로 저장하는 데에 사용되는 공간

**인터럽트의 동작 원리**

1. 인터럽트가 발생하면 A는 현재 수행 중인 명령의 위치를 저장함
2. 복귀 주소는 각 프로그램의 주소 공간 중 스택 영역에 보관
3. 인터럽트 때문에 CPU를 빼앗긴 위치는 운영체제가 관리하는 프로세스 제어블록에 저장
4. 프로세스 제어블록에는 인터럽트가 발생한 시점~수행된 부분 범위를 저장
5. 인터럽트 처리 후 저장된 범위를 복원시켜 원래 수행하던 일을 재개

## 2. 컴퓨터 시스템의 작동 개요

CPU는 매 시점 메모리의 특정 주소에 존재하는 명령을 하나씩 읽어와 그대로 실행할 뿐. 이때 CPU가 수행해야 할 메모리 주소를 담고 있는 레지스터를 프로그램 카운터\(PC\)라고 함.

**컴퓨터 시스템 구성요소**

* 하드웨어
  1. CPU
  2. 메모리 : 사용자 프로그램들과 운영체제가 같이 올라가 수행됨
  3. 입출력 장치\(입출력 컨트롤러, 로컬버퍼\)
* 소프트웨어

**CPU가 수행하는 명령**

1. 일반명령 : 메모리에서 자료를 읽어와 CPU에서 계산하고 결과를 메모리에 쓰는 일련의 명령
2. 특권명령 : 보안이 필요한 명령. 입출력 장치, 타이머 등 각종 장치에 접근하는 명령

## 3. 프로그램의 실행

'프로그램이 실행되고 있다' 의 의미

1. 디스크에 존재하던 실행파일이 메모리에 적재됨
2. 프로그램이 CPU를 할당받고 명령을 수행하고 있는 상태

운영체제의 기능

1. 아랫단의 하드웨어 자원을 효율적으로 관리하는 것
2. 윗단의 응용프로그램 및 사용자에게 편리한 서비스를 제공하는 것

## 4. 사용자 프로그램이 사용하는 함수

1. 사용자 정의함수
   * 프로그래머 본인이 직접 작성한 함수
2. 라이브러리 함수
   * 프로그래머 본인이 직접 작성하지는 않았지만 이미 누군가 작성해놓은 함수를 호출만 하여 사용하는 경우
3. 커널함수
   * 운영체제 커널의 코드에 정의된 함수
   * 커널함수의 종류에는 시스템 콜 함수, 인터럽트 처리 함수 등이 있음
   * 일반적인 함수호출과 시스템 콜 비교

     -일반적인 함수호출 : 사용자 프로그램 내에 존재하는 코드를 실행하는 것

     -시스템 콜 : 사용자 프로그램이 아닌 운영체제라는 별개의 프로그램에 CPU를 넘겨서 실행하는 것

## 5. 인터럽트

CPU는 프로그램 카운터가 가리키는 곳에 있는 명령을 수행하는 일만 하기 때문에, 다른 일을 수행하기 위해서는 인터럽트 매커니즘이 필요하다. 인터럽트 매커니즘은 원칙적으로, 인터럽트 처리 중에 또 다른 인터럽트가 발생하는 것을 허용하지 않는다. -&gt; 데이터의 일관성이 유지되지 않는 문제가 발생하기 때문

대신, 현재 처리 중인 인터럽트보다 더 높은 우선순위의 인터럽트가 발생한다면 현재 처리 중이던 인터럽트 코드의 수행 지점을 저장하고 우선순위가 높은 인터럽트를 처리하게 된다.

## 6. 시스템 콜

모든 프로그램은 자기 자신의 독자적인 주소 공간을 가지고 있으며, 프로그램이 함수호출을 하는 경우 자신의 주소 공간 내에서 호출이 이루어지게 된다.

시스템 콜은 함수호출이지만, 자신의 주소 공간을 거스르는 영역에 존재하는 함수를 호출하는 것

일반 함수 호출 - 자신의 스택에 복귀 주소를 저장한 후, 호출된 함수 위치로 점프하는 것

시스템 콜 - 주소 공간 자체가 다른 곳으로 이동해야 하므로 일반 함수호출과는 상이한 방법을 사용

**5~6의 정리 : 프로그램이 CPU를 할당받고 명령을 수행하다가 중간에 CPU를 빼앗기는 경우는 크게 두가지. 1\) 인터럽트 2\) 시스템 콜**

## 7. 프로세스의 두 가지 실행 상태

프로그램이 시작되어 종료될 때까지 다양한 함수호출을 하며 실행됨. -&gt; 사용자모드 / 커널모드의 실행 상태로 구분할 수 있음

**사용자모드**: 프로그램이 사용자 정의함수 또는 라이브러리 함수를 호출할 때

**시스템 콜**: 커널모드로 진입해 커널의 주소 공간에 정의된 함수를 실행. 시스템 콜의 실행이 끝나면 다시 사용자모드로 복귀해서 시스템 콜 이후의 명령들 실행

