# 객체 안전 공개

* 불변 객체라도 안전하게 공개하지 않으면 문제가 생길 수 있다.
  * ex\) final을 사용하지 않은 경우 생성자에서만 초기화하고, setter가 없더라도 문제가 생길 수 있다. \(결과적으로 불변인 객체\)
* 불변 객체가 아닌 객체는 모두 올바른 방법으로 안전하게 공개해야 하며 공개하는 스레드와 호출하는 스레드 모두에게 동기화하는 방법을 적용해야 한다.
* 불변 객체가 아닌 객체를 안전하게 공개하는 방법
  * 객체에 대한 참조를 static 메소드에서 초기화시킨다
  * 객체에 대한 참조를 volatile 변수 또는 AtomicReference 클래스에 보관한다
  * 객체에 대한 참조를 올바르게 생성된 클래스 내부의 final 변수에 보관한다
  * 락을 사용해 올바르게 막혀있는 변수에 객체에 대한 참조를 보관한다 \(컬렉션\)
* 다른 스레드에 안전하게 공개된 결과적인 불변 객체는 별다른 동기화 작업 없이도 여러 스레드에서 안전하게 호출해 사용할 수 있다.
* 가변객체를 사용할 때에는 공개하는 부분과 가변 객체를 사용하는 모든 부분에서 동기화 코드를 작성해야 한다. 
* 정리
  * 불변 객체는 어떤 방법으로 공개해도 아무 문제가 없다.
  * 결과적으로 불변인 객체는 안전하게 공개해야 한다.
  * 가변 객체는 안전하게 공개해야 하고 스레드에 안전하게 만들거나 락으로 동기화 시켜야 한다.
* 객체를 멀티쓰레드에서 사용하고 싶다면 객체가 어느정도 일을 할 수 있는지 알아야 한다. 객체를 사용하기 전에 동기화 코드를 적용해 락을 확보해야 하는가? 객체 내부의 값을 바꿔도 괜찮은가 아니면 값을 읽기만 하는가? 반대로 객체를 외부에서 사용할 수 있도록 공개할 때는 해당 객체를 어떤 방법으로 사용할 수 있고 사용해야 하는지 정확히 설명해야 한다.

