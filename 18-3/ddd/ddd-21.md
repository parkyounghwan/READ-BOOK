# DDD-21

## 리팩토링

리팩토링이란 소프트웨어의 기능을 수정하지 않고 설계를 다시 하는 것을 의미한다. 사전에 모든 설계 결정을 내리지 않고 기존의 기능은 유지한 채 코드를 변경하면서 설계를 유연하게 개선하거나 이해하기 쉽게 만든다. 자동화된 단위 테스트 스위트가 있으면 안전하게 리팩토링을 할 수 있다.

리팩토링은 두 가지 종류로 나눌 수 있다. 첫 번째는 우리가 일반적으로 리팩터링이라고 생각하는 방법이다. 코드의 가독성을 높이거나 기계적인 변경 \(패턴 적용?\)에 초점을 맞춘다. 책에서는 디자인 패턴을 향한 리팩터링라는 이름을 사용하는 것 같다.

두 번째 방법은 도메인에 대해 새로운 통찰력을 얻었을 때 코드를 사용해서 모델이 표현하고자 하는 바를 명확하게 드러내고자 하는 리팩토링이다. 코드의 상태를 개선하기 위해서 하는 것보다는 통찰력을 갖추기 위해 모델을 만들기 위해 변경을 한다.

## 심층 모델

전통적인 설계 방법은 요구사항 문서에 적힌 명사와 동사를 식별하여 명사를 객체 이름으로, 동사를 객체의 메서드로 사용한다. 이런 방법은 초보자가 이해하기는 쉬우나 만들어진 모델이 투박하고 무의미한 모델이다. 모델의 물리적인 측면은 잘 표현하지만 도메인의 본질을 반영하지는 않는다. 실제 세계에서는 중요하지 않더라도, 애플리케이션에서 중요한 로직을 반영하는 객체를 강조하고, 실제 세계에서는 중요하더라도 애플리케이션에서 의미가 없다면 표현할 필요가 없다.

예를 들어 생각해보면, 자동차에서 가장 중요한 건 엔진이다. 하지만 자동차 운전 시뮬레이터에서는 엔진이라는 개념이 중요하지 않다. 오히려 핸들이 더 중요하다. 엔진이라는 객체가 자동차 운전 시뮬레이터에서는 큰 의미를 가지지 않는다.

책에서 정리하기를, 심층 모델이란 "도메인의 피상적인 측면은 배제하고 도메인 전문가의 주요 관심사와 갖아 적절한 지식을 알기 쉽게 표현하는 모델이다"라고 한다. 심층 모델이 일반적으로 추상적인 요소를 포함하지만, 문제의 핵심을 관통하는 구체적인 요소 또한 포함한다.

도메인과 조화를 이루는 모델은 융통성과 단순함, 설명력을 얻을 수 있다. 모델에는 도메인 전문가가 사용하는 단순하지만 추상적인 언어가 반영된다.

## 유연한 설계

심층 모델을 얻기 위해서는 지속적인 리팩토링이 필요하고, 지속적인 리팩토링은 유연한 설계가 필요하다. 유연한 설계란, 중복되는 공통적인 부분을 쉽게 처리하고 변경이 필요한 지점에 유연성을 제공하는 설계를 의미한다. 어느 부분이 변경이 필요한지 판단이 중요하다. 유연한 설계는 변경을 촉진하고 모델 개선에도 기여한다. 설계에는 디자인 패턴을 참고할 수 있다. 적절한 디자인 패턴을 찾았다고 바로 적용하면 안된다. 디자인 패턴은 고민해야 하는 범위를 줄여주는 역할로 사용해야 한다.

그동안 설계와 모델에 대한 개념이 와닿지 않았다. 특히 모델의 개념이 너무 모호해서 이해하기 어려웠는데 책에서 예제와 설명을 반복하니 조금씩 의미가 느껴진다. 설계는 코드에 가까운 개념으로, 우리가 애플리케이션에서 요구하는 기능을 구현하기 위해 코드로 모델을 표현하는 과정인 것 같다. 모델은 우리가 설계를 통해 만들어낸 객체들의 조합으로 만들어지는 추상적인 개념이라고 느껴졌다.

