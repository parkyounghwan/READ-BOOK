# DDD-06

## LAYERED ARCHITECTURE

각 계층을 분리하고 계층이 같은 계층 혹은 바로 아래 계층에만 의존해야 한다. 인프라스트럭쳐가 예외인데 서비스를 통해 도메인, 응용 계층에 기능을 제공한다. 서비스의 범위와 인터페이스를 잘 선정하고 설계하여 느슨하게 결합하고 단순한 형태를 유지해야 한다.

많은 인프라스트럭쳐의 공통된 요구사항을 해결하기 위해서 프레임워크가 존재한다. 다만 프레임워크 클래스의 하위 클래스가 되야한다거나 일정한 메소드 시그니처를 가져야 할 수도 있다. 프레임워크를 잘 활용하면 기타 인프라스트럭쳐 구현사항이 아닌 모델을 표현하는 것에만 집중하여 기술적 난제를 해결할 수 있다.

### VS SMART UI

SMART UI는 도메인이 UI와 연관을 가지도록 설계하는 아키텍처이다. 모든 프로젝트에 도메인 주도 설계가 적합한 것은 아니다. 요구사항이 간단하고 빠른 구현이 필요한 프로젝트이고 팀이 도메인 주도 설계에 적합하지 않다면 UI가 도메인과 연관된 SMART UI가 적합할 수도 있다. 도메인 주도 설계는 요구사항이 복잡한 프로젝트이고 기술력이 뛰어난 팀이 프로젝트에 참여할 때 적합하다.

## 도메인 구현 격리

도메인 주도 설계를 하기 위한 첫 걸음으로는 도메인 구현 격리이다. 도메인을 격리하여 시스템의 다른 부분과 느슨하게 결합될 수 있도록 해야 한다. 하지만 도메인은 인프라스트럭처나 사용자 인터페이스의 영향을 받기 쉽다. 이를 해결하기 위해서는 이후에 다루는 내용을 공부해야 한다.

### 모델을 표현하는 객체

모델을 표현하는 객체에는 ENTITY, VALUE OBJECT, SERVICE 세 가지가 있다. 객체가 연속성과 식별성을 가질 경우 ENTITY이다. 연속성은 상태가 변화하는 것이 일시적이 아니라 유지되는 것을 뜻한다. \(데이터 저장소에서 꺼내와도 상태는 유지된다\) 식별성은 상태를 바탕으로 추적하거나 서로 다른 구현에서 공통적으로 존재하는 특성을 의미한다. 상태만을 기록하는 데 사용되면 VALUE OBJECT이다. 모델을 표현하는 데 행동이나 연산이 적합하다면 SERVICE를 사용한다. 도메인에도 SERVICE가 있는데 ENTITY와의 차이점은 SERVICE는 상태를 주고 받지 않는다. 데이터베이스에 저장하려면 객체 모델의 무결성을 포기해야할 수도 있는데 해결하는 방법을 뒤에서 설명한다고 한다.

### 연관 관계

객체 간 연관 관계를 통해서 모델을 구현하게 된다. 연관 관계는 잘 다루어야 한다. 양방향을 단방향으로 만들거나 제거하여 최대한 줄인다. 한정자 \(Qualifer\)를 부여하여 다중성을 줄인다. 무슨 말이냐면 최대한 1:N 관계를 1:1로 줄인다. 최대한 연관 관계에 제약조건을 다는 것이 중요하다. 존재하는 양방향 관계는 의미를 가져야 한다. 연관 관계를 일관되게 제약하다보면 연관 관계의 의미를 가지게 되고 구현이 단순해지며 도메인 특성이 반영되게 된다.

