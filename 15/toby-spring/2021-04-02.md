# 2021-04-02

### 컨테이너가 자동등록하는 빈

스프링 컨테이너는 초기화 과정에서 몇 가지 빈을 기본적으로 등록해준다.

**ApplicationContext, BeanFactory**

스프링에서는 컨테이너 자신을 빈으로 등록해두고 필요하면 일반 빈에서 DI 받아서 사용할 수 있다. 스프링 컨테이너인 애플리케이션 컨텍스트는 ApplicationContext 인터페이스를 구현한 것이다. 애플리케이션 컨텍스트를 일반 빈에서 사용하고 싶다면 ApplicationContext타입의 빈을 DI받도록 선언해주면 된다. 컨텍스트 자신은 이름을 가진 빈으로 등록되어 있지 않다. 따라서 타입으로 접근하면 된다.

빈 팩토리는 ApplicationContext 구현 클래스 안에 내부적으로 따로 생성해두기 때문에 BeanFactory로 DI 받는 오브젝트는 ApplicationContext로 가져오는 오브젝트와 다르다.

**ResourceLoader, ApplicationEventPublisher**

코드를 통해 서블릿 컨텍스트의 리소스를 읽어오고 싶다면 컨테이너를 ResouceLoader 타입으로 DI 받아서 활용하면 된다.단지 리소스를 읽어오려는 목적이라면 용도도 맞게 적절한 인터페이스타입으로 DI받아 사용하는 것이 바람직하다.

**systemProperties, systemEnvironment**

systemProperties 빈은 System.getProperties\(\) 메소드가 돌려주는 Properties 타입의 오브젝트를 읽기전용으로 접근할 수 있게 만드는 빈 오브젝트다. JVM이 생성해주는 시스템 프로퍼티 값을 읽을 수 있게 해준다. 코드에서 시스템 프로퍼티를 사용한다면 System.getProperty\("os.name"\)처럼 직접 코드로 만드는 편이 낫다. 스프링의 빈 프로퍼티에 시스템 프로퍼티의 값을 넣어줄 때는 스프링이 빈으로 접근하게 만들어준 systemProerties빈을 이용하면 편리하다.

systemEnvironment는 System.getenv\(\)에서 제공하는 환경변수가 담긴 Map 오브젝트다.

## 프로토타입과 스코프

빈을 싱글톤이 아닌 다른방법으로 만들어 사용해야 할 때가 있다. 빈당 단 하나의 오브젝트만을 만드는 싱글톤 대신, 하나의 빈 설정으로 여러 개의 오브젝트를 만들어서 사용하는 경우다. 싱글톤이 아닌 빈은 크게 두가지로 나눌 수 있다. 프로토타입 빈과 스코프 빈이다.

### 프로토타입 스코프

프로토타입 빈은 컨테이너에 빈을 요청할 때마다 새로운 오브젝트를 만드는 것이다.

**프로토타입 빈의 생명주기와 종속성**

IoC의 기본 개념은 애플리케이션을 구성하는 핵심 오브젝트를 코드가 아니라 컨테이너가 관리한다는 것이다. 스프링이 관리하는 오브젝트인 빈은 그 생성과 다른 빈에대한 의존관계 주입, 초기화, DI와 DL을 통한 사용, 제거에 이르기까지 모든 오브젝트의 생명주기를 컨테이너가 관리한다.

프로토타입 빈은 독특하게 이 IoC의 기본 원칙을 따르지 않는다. 프로토타입 스코프를 갖는 빈은 요청이 있을 때마다 컨테이너가 생성하고 초기화하고 DI까지 해주기도 하지만 일단 빈을 제공하고 나면 컨테이너는 더 이상 빈 오브젝트를 관리하지 않는다. 이때부터는 DL을 통헤서 오브젝트를 가져간 코드나 DI로 주입받은 다른 빈이 사실상 컨테이너가 제공한 빈 오브젝트를 관리하게 된다.

**프로토타입 빈의 용도**

프로토타입 빈은 코드에서 new로 오브젝트를 생성하는 것을 대신하기 위해 사용된다.

오브젝트에 DI를 적용하려면 컨테이너가 오브젝트를 만들게 해야한다. 코드에서 일일이 수동으로 수정자 메소드를 호출해서 DI 해줄 것이 아니라면 말이다. 바로 이런 경우에 프로토타입 빈이 유용하다. 프로토타입 빈은 오브젝트의 생성과 DI 작업까지 마친 후에 컨테이너가 돌려준다. 매번 새로운 오브젝트가 필요하면서 DI를 통해 다른 빈을 사용할 수 있어야 한다면 프로토타입 빈이 가장 적절한 선택이다.

DI를 적용하려면 결국 컨테이너에 오브젝트 생성을 맡겨야 한다. 또한 컨테이너가 만드는 빈이지만 매번 같은 오브젝트를 돌려주는 것이 아니라 new로 생성하듯이 새로운 오브젝트가 만들어지게 해야한다. 바로 프로토타입 스코프 빈이 필요할 때다.

오브젝트 중심적이고 유연한 확장을 고려한다면 프로토타입 빈을 이용하는 편이 나을 것이다.

