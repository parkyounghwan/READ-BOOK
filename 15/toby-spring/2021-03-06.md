# 2021-03-06

## IoC 컨테이너의 종류와 사용 방법

**StaticApplicaionContext**

StaticApplicationContext는 코드를 통해 빈 메타정보를 등록하기 위해 사용한다. 스프링의 기능에 대한 학습 테스트를 만들 때를 제외하면 실제로 사용되지 않는다.

테스트 목적으로 코드를 통해 빈을 등록하고 컨테이너가 어떻게 동작하는지 확인하고 싶을 때를 대비해 사용하는 컨테이너

**GenericApplicationContext**

가장 일반적인 애플리케이션 컨텍스트의 구현 클래스.

실전에서 사용될 수 있는 모든 기능을 갖추고 있는 애플리케이션 컨텍스트.

스프링 컨테이너를 확장해서 새로운 프레임워크를 만들거나, 스프링을 사용하는 독립형 애플리케이션을 만들지 않는 한, 스프링을 이용하면서 GenericApplicationContext를 직접 이용할 일은 없다.

GenericApplicationContext는 코드에서 직접 만들고 초기화 하지 않을 뿐이지 실제로 자주 사용된다.

Junit 테스트는 테스트내에서 사용할 수 있도록 애플리케이션 컨텍스트를 자동으로 만들어주는데 이때 생성되는 컨텍스트가 GenericApplicationContext이다.

**GenericXmlApplicationContext**

코드에서 GenericApplicationContext를 사용하는 경우에는 번거롭게 XmlBeanDefinitionReader를 직접 만들지 말고, 이 두 개의 클래스가 결합된 GenericXmlApplicationContext를 사용하면 편리하다.

**WebApplicationContext**

스프링 애플리케이션에서 가장 많이 사용되는 애플리케이션 컨텍스트.

웹 환경에서 사용할 때 필요한 기능이 추가된 애플리케이션 컨텍스트

스프링 IoC컨테이너는 빈 설정 메타정보를 이용해 빈 오브젝트를 만들고 DI 작업을 수행한다. 하지만 그것만으로는 애플리케이션이 동작하지 않는다. 마치 자바 애플리케이션의 main\(\) 메소드 처럼 어디에선가 특정 빈 오브젝트의 메소드를 호출함으로써 애플리케이션을 동작시켜야 한다.

IoC 컨테이너의 역할은 이렇게 초기에 빈 오브젝트를 생성하고 DI 한 후에 최초로 애플리케이션을 기동할 빈 하나를 제공해주는 것 까지다.

웹 환경에서는 main\(\)메소드 대신 서블릿 컨테이너가 브라우저로부터 오는 HTTP 요청을 받아서 해당 요청에 매핑되어 있는 서블릿을 실행해주는 방식으로 동작한다. 서블릿이 일종의 main\(\) 메소드와 같은 역할을 하는 셈이다.

웹 애플리케이션에서 스프링 애플리케이션을 기동시키는 방법은 main\(\) 메소드 역할을 하는 서블릿을 만들어두고, 미리 애플리케이션 컨텍스트를 생성해둔 다음, 요청이 서블릿으로 들어올 때마다 getBean\(\)으로 필요한 빈을 가져와 정해진 메소드를 실행해주면 된다.

서블릿 컨테이너는 브라우저와 같은 클라이언트로부터 들어오는 요청을 받아서 서블릿을 동작시켜주는 일을 맡는다. 서블릿은 웹 애플리케이션이 시작될 때 미리 만들어둔 웹 애플리케이션 컨텍스트에게 빈 오프젝트로 구성된 애플리케이션의 기동 역할을 해줄 빈을 요청해서 받아둔다. 그리고 미리 지정된 메소드를 호출함으로써 스프링 컨테이너가 DI 방식으로 구성해둔 애플리케이션의 기능이 시작되는 것이다.

웹 애플리케이션에서 만들어지는 스프링 IoC컨테이너는 WebApplicationContext 인터페이스를 구현한 것이다.

## IoC 컨테이너 계층구조

**부모 컨텍스트를 이용한 계층구조 효과**

모든 애플리케이션 컨텍스트는 부모 애플리케이션 컨텍스트를 가질 수 있다. 이를 이용하면 트리구조의 컨텍스트 계층을 만들 수 있다.

계층구조 안의 모든 컨텍스트는 각자 독립적인 설정정보를 이용해 빈 오브젝트를 만들고 관리한다. 각자 독립적으로 자신이 관리하는 빈을 갖고 있긴 하지만 DI를 위해 빈을 찾을때는 부모 애플리케이션 컨텍스트의 빈까지 모두 검색한다.

자신의 부모 컨택스트에게만 빈 검색을 요청하지 자식 컨텍스트에게는 요청하지 않는다. 그런 이유로 같은 레벨에 있는 형제 컨텍스트의 빈도 찾을 수 없다.

검색 순서는 항상 자신이 먼저이고, 그런 다음 직계 부모 순이다. 따라서 부모 컨텍스트와 같은 이름의 빈을 자신이 정의해서 갖고 있다면 자신이 가진 것이 우선이고 부모 컨텍스트가 정의한 것은 무시된다.

기존 설정을 수정하지 않고 사용하지만 일부 빈 구성을 바꾸고 싶은 경우, 애플리케이션 컨텍스트의 계층구조를 만드는 방법이 편리하다.

계층구조를 이용하는 또 한 가지 이유는 여러 애플리케이션 컨텍스트가 공유하는 설정을 만들기 위해서다.

각자 용도와 성격이 달라서 웹 모듈을 여러 개로 분리하긴 했지만 핵심 로직을 담은 코드는 공유하고 싶을 때 이런 식으로 구성한다.

AOP처럼 컨텍스트 안의 많은 빈에 일관적으로 적용되는 기능은 대부분 해당 컨텍스트로 제한된다는 점도 주의하자.

